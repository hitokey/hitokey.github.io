<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt_BR" xml:lang="pt_BR">
<head>
<!-- 2022-03-31 Thu 03:36 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Clean + LISP from Web System</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Pedro Fernandes" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/hideshow.css"/>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/bigblow.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/hideshow.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Clean + LISP from Web System</h1>
<div id="table-of-contents">
<h2>&Iacute;ndice</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org1aeec8d">1. Sistema Web.</a>
<ul>
<li><a href="#org3550d3b">1.1. Clean</a></li>
<li><a href="#org527166f">1.2. Instalação</a></li>
<li><a href="#orgc359b59">1.3. Configuração.</a></li>
<li><a href="#org202a05c">1.4. Simples programa em Clean para Web.</a></li>
<li><a href="#org8ad80d3">1.5. Mas Falaremos um pouco de LISP.</a></li>
<li><a href="#org3aeb6f6">1.6. Lisp GGI.</a></li>
<li><a href="#orgc9e6f4e">1.7. Lisp control Clean por Object System Interface</a></li>
<li><a href="#org83f4831">1.8. Lisp and Clean Foreign Function Interface</a>
<ul>
<li><a href="#orgdbe60e1">1.8.1. Clean Foreign</a></li>
</ul>
</li>
<li><a href="#orgc25648e">1.9. Lisp Hunchentoot Básico</a></li>
<li><a href="#orgbfd4b42">1.10. GET hello - programa;</a></li>
<li><a href="#org2eec93c">1.11. Lisp Hunchentoot Avancado</a></li>
</ul>
</li>
<li><a href="#org786caae">2. Home</a></li>
</ul>
</div>
</div>

<div id="outline-container-org1aeec8d" class="outline-2">
<h2 id="org1aeec8d"><span class="section-number-2">1</span> Sistema Web.</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org3550d3b" class="outline-3">
<h3 id="org3550d3b"><span class="section-number-3">1.1</span> Clean</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Clean e Lisp são linguagens funcionais.
</p>
</div>
</div>

<div id="outline-container-org527166f" class="outline-3">
<h3 id="org527166f"><span class="section-number-3">1.2</span> Instalação</h3>
<div class="outline-text-3" id="text-1-2">
<p>
A instalação é bastante simples, por iremos já utiliza-se de uma versão já pré-compilada. Sendo assim não será preciso configuramos muita coisa. Além disso como queremos criar um páginas Web para servidores linux, iremos baixar a versão clean-bundle-complete-linux-x64-latest.tgz. Você consiguirá acessando a seguinte página do <a href="https://wiki.clean.cs.ru.nl/Download_Clean">Clean</a>.
</p>
</div>
</div>

<div id="outline-container-orgc359b59" class="outline-3">
<h3 id="orgc359b59"><span class="section-number-3">1.3</span> Configuração.</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Depois de baixar o arquivo, pelo terminal fazemos as seguintes configuração.
</p>

<pre class="example">
# mv Download/clean-bundle-complete-linux-x64-latest.tgz ~/
# tar xvf clean-bundle-complete-linux-x64-latest.tgz .
# mv clean-bundle-complete clean/
</pre>

<p>
Com o directório clean criado, vamos então configura no arquivo ~/.bashrc as seguintes variáveis.
</p>

<pre class="example">
# echo "export CLEAN_HOME=~/clean &gt;&gt; ~/.bashrc
# echo "export PATH=$PATH:$CLEAN_HOME/bin &gt;&gt; ~/.bashrc
</pre>
</div>
</div>

<div id="outline-container-org202a05c" class="outline-3">
<h3 id="org202a05c"><span class="section-number-3">1.4</span> Simples programa em Clean para Web.</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Neste casso, o programa que iremos aborda são para web servering, com pro exemplo o apache, ningx etc. Servidores que gerencia todas as conexão e requisições necessárias para uma comunicação web. Tais programas chamamos de Common Gateway Inferface (CGI). Recomendo o excelente livro: <a href="https://docstore.mik.ua/orelly/linux/cgi/index.htm">CGI Programming with perl</a>, aonde ele aborta tais methodo. Então, vamos ao program.
</p>

<pre class="example">
module printenv;

import StdEnv, ArgEnv;

Start w
  # (cgi, w) = stdio w;
  # ctype= "Content-Type:text/html;charset=utf-8";
  # cgi= fwrites ctype cgi;
  # cgi= fwrites({toChar 13, toChar 10}+++"\n") cgi;
  # cgi= fwrites "&lt;html&gt;\n" cgi;
  # cgi= fwrites "&lt;body&gt;\n" cgi;
  # cgi= fwrites "&lt;h1&gt;Hello: " cgi;
  # xx= ans (getEnvironmentVariable "QUERY_STRING");
  # cgi= fwrites (xx+++"&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n") cgi;
  = cgi;
where {
   ans EnvironmentVariableUndefined="none";
   ans (EnvironmentVariable v)= v; }
</pre>

<p>
No Clean precisamos antes de rodar nosso program complilar nosso código, iremos usar um parte importe dos arquivos já baixados, que é o ArgEnv, o mesmo deverá está no directorio lib/ dentro do directorio do clean baixado. Então, tente vê se caso receba um erro, pode ser que esteja faltando esta library. Vejamos, como complilamos este código.
</p>

<div class="org-src-container">
<pre class="src src-sh">clm -b -nt -nr hello-web -O hello.cgi
./hello.cgi
</pre>
</div>

<p>
Tal program retorna quando rodado no localmente.
</p>

Content-Type:text/html;charset=utf-8

<html>
<body>
<h1>Hello: none</h1>
</body>
</html>

<p>
Discutiremos um pouco sobre o programa. O codigo é bastante simples, basicamente ele concatena string no formato response html, com um variável do servidor que é a QUERY<sub>STRING</sub>, tal variável amazena um parte do URL. Nesta parte normalmente poderá ser passado alguma key e valor, por exemplo, vejamos a URL:
</p>

<p>
Recomendo que leia o <a href="https://docstore.mik.ua/orelly/linux/cgi/ch03_02.htm">Enviroment Variables</a> e <a href="https://docstore.mik.ua/orelly/linux/cgi/ch02_01.htm">HTTP</a>.
</p>
</div>
</div>

<div id="outline-container-org8ad80d3" class="outline-3">
<h3 id="org8ad80d3"><span class="section-number-3">1.5</span> Mas Falaremos um pouco de LISP.</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Estou abortando o lisp nesta documento porque objetivo maior é interligamos as linguagem LISP com a linguagem CLEAN. Aonde deixamos que o Lisp gerencie o Servidor e usamos programas já escrito nele CLEAN, nem a necessidade de reescremos o mesmo.
</p>

<p>
Obs.: Esta ideia é apenas para um treinamento e educacional, não haverá um comparação desempenho ou uma tentativa de explicação do porque fazemos isto e não optamos por simples programa no flask + gunicorn do python, ou outra linguagem popular do momento em que estiver lendo este documento.
</p>
</div>
</div>

<div id="outline-container-org3aeb6f6" class="outline-3">
<h3 id="org3aeb6f6"><span class="section-number-3">1.6</span> Lisp GGI.</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Podemos também fazer um aplicação GUI com o lisp, não é nosso objetivo, mas podemos observar.
</p>

<pre class="example">
#!/usr/bin/sbcl --script

(format t "Content-type: text/html~%~%")

(format t
" &lt;html&gt;
   &lt;body&gt;
    &lt;h1&gt;Hello, ~a&lt;/h1&gt;
   &lt;/body&gt;
  &lt;/html&gt;"
(getenv 'QUERY_STRING)
)
</pre>

<p>
Neste caso, vale observar que diferente do clean está versão do código e impletado em tempo de execução, ou seja, está no formato script.
</p>
</div>
</div>

<div id="outline-container-orgc9e6f4e" class="outline-3">
<h3 id="orgc9e6f4e"><span class="section-number-3">1.7</span> Lisp control Clean por Object System Interface</h3>
<div class="outline-text-3" id="text-1-7">
<p>
Primeira, uma alternativa para controle do clean programa é usamos o controle de sistema apartir do SO(Sistema Operacional), dessa maneira codificado.
</p>

<pre class="example">
(sb-ext:run-program "./hello.cgi" nil :output *standard-output*)
</pre>

<p>
Temos o resultado:
</p>
<pre class="example">
Hello,World!
#&lt;SB-IMPL::PROCESS :EXITED 0&gt;
</pre>

<p>
Usamos a função run-program possui um variação dependendo do common lisp que esteja executado, no sbcl o package sb-ext, já por exemplo ecl, o run-program está no package <b>ext</b> apenas, neste caso a estrutura é a mesma, em todo caso sempre der uma olhada no manual do seu imterpetador, mas não se preocupe muito, existem esta diferença mas normalmente elas são voltada mais para pacotes extras de cada imterpetador, mas o restante todos os interpetador que seguem a padrão ANSI, contando que estamos falando se Common Lisp, não de Lisp. Que são o lisp do sbcl e ecl. Vejamos o OSI do ecl.
</p>

<pre class="example">
(ext:run-program "./hello" nil :output :stream)
</pre>

<pre class="example">
Hello,World!

#&lt;output stream "FD-STREAM" 0x7fffc8ba2e60&gt;
0
#S(EXT:EXTERNAL-PROCESS :PID NIL :INPUT #&lt;output stream "FD-STREAM" 0x7fffc8ba2e60&gt; :OUTPUT NIL :ERROR-STREAM #&lt;input stream "FD-STREAM" 0x7fffc8ba2dc0&gt; :%STATUS :EXITED :%CODE 0 :%LOCK #&lt;lock (nonrecursive) 0x7fffc8927300&gt; :%PIPE #&lt;process 0x7fffc88fcf80&gt;)
</pre>

<p>
Vemos que o retorno no ecl, são três valores, podemos que podemos processá-los como quisermos, exemplo:
</p>

<pre class="example">
(multiple-value-bind (x y z) (ext:run-program "./hello" nil :output t) z))
</pre>

<p>
Neste casso apenas pegamos o z, que o processo.
</p>
<pre class="example">
#S(EXT:EXTERNAL-PROCESS :PID NIL :INPUT #&lt;output stream "FD-STREAM" 0x7fffea8ac8c0&gt; :OUTPUT NIL :ERROR-STREAM #&lt;input stream "FD-STREAM" 0x7fffea8ac820&gt; :%STATUS :EXITED :%CODE 0 :%LOCK #&lt;lock (nonrecursive) 0x7fffea3bdbd0&gt; :%PIPE #&lt;process 0x7fffea464880&gt;)
</pre>

<p>
De qualquer forma o common lisp permite que controle qual será a função que iremos chamar verificado a versão do interpetador, por exemplo:
</p>

<pre class="example">
(defun my-run (program argv)
     (declare (type string program))
     (declare (type list argv))
   (let ((process 
	  (or #+sbcl (sb-ext:process-output
			(sb-ext:run-program program argv :output :stream))
	      #+ecl (ext:run-program program argv :output :stream)) ))
     (loop for line = (read-line process nil nil)
	 while line do (format t "~a" line)) )) 


(my-run "./hello" nil)
</pre>

<pre class="example">
Hello,World!
NIL
</pre>

<p>
Então, com este processo podemos por exemplo controlar produtor de audio, por exemplo, vejamos.
</p>

<pre class="example">
(sb-ext:run-program "play" '("/home/pedro/sound/sound.mp3")
			    :output nil :wait nil)
</pre>

<p>
<b>Obs.</b>: é necessario ter o sox instalado, instalar: sudo apt install sox
</p>

<pre class="example">
(sb-ext:run-program "cmd.exe" '("/C" "start" "D:/Sound/sound.mp3")
				:search t :windows :hide)
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listagem 5 </span>Linux in Windows (WSL)</label><pre class="src src-lisp">(sb-ext:run-program <span style="color: #ffa07a;">"cmd.exe"</span> '(<span style="color: #ffa07a;">"/C"</span> <span style="color: #ffa07a;">"start"</span> <span style="color: #ffa07a;">"D:/Sound/sound.mp3"</span>)
                               <span style="color: #76ee00;">:search</span> t )                   
</pre>
</div>

<p>
Vemos que podemos controlar varios process entre outro com o lisp, então uma possibilidade é controla o programa compilado em clean, afinal o programa estará em formato <b>elf</b>, vamos então testa-lo, usamos o programa my-run, escrito anteriormente.
</p>

<pre class="example">
(my-run "./hello.cgi" nil)
</pre>

<p>
Vemos que conseguimos reproduzir no lisp a resposta do clean, vejamos o resultado abaixo.
</p>
<pre class="example">
&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello: none&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
NIL
</pre>
</div>
</div>

<div id="outline-container-org83f4831" class="outline-3">
<h3 id="org83f4831"><span class="section-number-3">1.8</span> Lisp and Clean Foreign Function Interface</h3>
<div class="outline-text-3" id="text-1-8">
<p>
Vamos começa usando function do clean no lisp. Então quando olhamos no manual do cleam, vejamos como export seu código do clean para serem usado em outra linguagem, que pode ser n-linguagem, inclusive o python, mas iremos utilizar a código clean no Lisp.
</p>
</div>

<div id="outline-container-orgdbe60e1" class="outline-4">
<h4 id="orgdbe60e1"><span class="section-number-4">1.8.1</span> Clean Foreign</h4>
</div>
</div>

<div id="outline-container-orgc25648e" class="outline-3">
<h3 id="orgc25648e"><span class="section-number-3">1.9</span> Lisp Hunchentoot Básico</h3>
<div class="outline-text-3" id="text-1-9">
<p>
O sistema hunchentoot é um interface de rede com ferramentas para construções de sites dinamicos. Ele funciona com um servidor web independente, ele é capaz de conexão HTTP/1.1 chunking, conexão persistentes e SSL. Além disso ele fornece diversos recurso de manipulação automatica de sessão, registro etc. Ou seja, ele tem além dessa funções muitas outras, mas caso queira saber de todas visite o site do <a href="http://edicl.github.io/hunchentoot/">hunchentoot</a>.
</p>

<p>
Então começamos o que interessa, construir uma aplicação web-server em lisp. Começamos com algo simples, um helloword
</p>

<pre class="example">
(ql:quickload :hunchentoot)
</pre>

<pre class="example">

(ql:quickload :hunchentoot)
To load "hunchentoot":
  Load 1 ASDF system:
    hunchentoot
; Loading "hunchentoot"

(:HUNCHENTOOT)
</pre>

<p>
Como iremos precisar do hunchentoot, podemos usar o quicklisp para carrega-lo, caso seja a primeira vez fazendo este commando, o sistema irá apresentar mais infomações com um semelhante a isto:
</p>

<pre class="example">
; Loading "hunchentoot"
[package chunga]..................................
[package cl-base64]...............................
[package cl-fad]..................................
[package path]....................................
[package cl+ssl/config]...........................
[package usocket].................................
[package cl+ssl]..................................
[package md5].....................................
[package rfc2388].................................
[package trivial-backtrace].......................
[package url-rewrite].............................
[package hunchentoot]..........................
(:HUNCHENTOOT)
</pre>

<p>
Como hunchentoot em vale ressaltar, que qualquer infomação dentro desse pacote terãom o sufixo hunchentoot:, caso queira evitar isto basta usar <b>in-package</b>, mais informaçãoes <a href="https://www.tutorialspoint.com/lisp/lisp_packages.htm">link</a>.
</p>

<p>
Então começamos iniciando um servidor http simples, com uma função dinamica que pegar a query<sub>string</sub> é diz um Hello, caso não term a query<sub>string</sub>, diz hello, world.
</p>

<pre class="example">
(hunchentoot:start (make-instance 'hunchentoot:easy-acceptor :port 4242))
</pre>

<pre class="example">
#&lt;HUNCHENTOOT:EASY-ACCEPTOR (host *, port 4242)&gt;
</pre>

<p>
Como este commando iniciamos o sevidor na porta 4242 no localhost(que é ip do local do nosso computador), se você iniciou, acesse por <a href="http://localhost:4242">http://localhost:4242</a>, esta porta podemos escolher, mas devemos ficar atento com as portas já utilizados pelo SO e outra aplicações Web. O numero da porta possui um intervalos de (0 à \({2^10}\). Você pode vê as opções <a href="https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers">aqui</a>.
</p>


<p>
Quando acessar o link pelo browser veremos isto no browser:
</p>

<p>
<a href="./localhost.png">Web Server</a>
</p>

<p>
E isso no terminal:
</p>

<pre class="example">
127.0.0.1 - [2022-03-31 02:04:52] "GET / HTTP/1.1" 200 393 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.84 Safari/537.36"
</pre>
</div>
</div>

<div id="outline-container-orgbfd4b42" class="outline-3">
<h3 id="orgbfd4b42"><span class="section-number-3">1.10</span> GET hello - programa;</h3>
<div class="outline-text-3" id="text-1-10">
<p>
Então programos o hello world pelo método GET:
</p>
</div>
</div>

<div id="outline-container-org2eec93c" class="outline-3">
<h3 id="org2eec93c"><span class="section-number-3">1.11</span> Lisp Hunchentoot Avancado</h3>
<div class="outline-text-3" id="text-1-11">
<p>
Vamos fazer alguma applicação mais complexa, que são o seguintes pontos:
</p>

<ul class="org-ul">
<li>GET/POST REQUEST</li>
<li>HTTP HEADERS</li>
<li>Input/Output JSON</li>
<li>Input/Output RAW BYTES INFOMATION</li>
<li>Authentification</li>
<li>CGI script</li>
<li>Database Controle.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org786caae" class="outline-2">
<h2 id="org786caae"><span class="section-number-2">2</span> <a href="https://hitokey.github.io/">Home</a></h2>
<div class="outline-text-2" id="text-2">
<p>
Minha Página (My Page): <a href="https://hitokey.github.io/">link</a>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Data: 2022-03-24 Thu 00:00</p>
<p class="author">Autor: Pedro Fernandes</p>
<p class="date">Created: 2022-03-31 Thu 03:36</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
